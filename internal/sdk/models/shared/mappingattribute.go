// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package shared

import (
	"errors"
	"fmt"
	"github.com/epilot-dev/terraform-provider-epilot-automation/internal/sdk/internal/utils"
)

type MappingAttributeType string

const (
	MappingAttributeTypeSetValueMapper    MappingAttributeType = "SetValueMapper"
	MappingAttributeTypeCopyValueMapper   MappingAttributeType = "CopyValueMapper"
	MappingAttributeTypeAppendValueMapper MappingAttributeType = "AppendValueMapper"
)

type MappingAttribute struct {
	SetValueMapper    *SetValueMapper    `queryParam:"inline,name=MappingAttribute" union:"member"`
	CopyValueMapper   *CopyValueMapper   `queryParam:"inline,name=MappingAttribute" union:"member"`
	AppendValueMapper *AppendValueMapper `queryParam:"inline,name=MappingAttribute" union:"member"`

	Type MappingAttributeType
}

func CreateMappingAttributeSetValueMapper(setValueMapper SetValueMapper) MappingAttribute {
	typ := MappingAttributeTypeSetValueMapper

	return MappingAttribute{
		SetValueMapper: &setValueMapper,
		Type:           typ,
	}
}

func CreateMappingAttributeCopyValueMapper(copyValueMapper CopyValueMapper) MappingAttribute {
	typ := MappingAttributeTypeCopyValueMapper

	return MappingAttribute{
		CopyValueMapper: &copyValueMapper,
		Type:            typ,
	}
}

func CreateMappingAttributeAppendValueMapper(appendValueMapper AppendValueMapper) MappingAttribute {
	typ := MappingAttributeTypeAppendValueMapper

	return MappingAttribute{
		AppendValueMapper: &appendValueMapper,
		Type:              typ,
	}
}

func (u *MappingAttribute) UnmarshalJSON(data []byte) error {

	var candidates []utils.UnionCandidate

	// Collect all valid candidates
	var setValueMapper SetValueMapper = SetValueMapper{}
	if err := utils.UnmarshalJSON(data, &setValueMapper, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  MappingAttributeTypeSetValueMapper,
			Value: &setValueMapper,
		})
	}

	var copyValueMapper CopyValueMapper = CopyValueMapper{}
	if err := utils.UnmarshalJSON(data, &copyValueMapper, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  MappingAttributeTypeCopyValueMapper,
			Value: &copyValueMapper,
		})
	}

	var appendValueMapper AppendValueMapper = AppendValueMapper{}
	if err := utils.UnmarshalJSON(data, &appendValueMapper, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  MappingAttributeTypeAppendValueMapper,
			Value: &appendValueMapper,
		})
	}

	if len(candidates) == 0 {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for MappingAttribute", string(data))
	}

	// Pick the best candidate using multi-stage filtering
	best := utils.PickBestUnionCandidate(candidates, data)
	if best == nil {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for MappingAttribute", string(data))
	}

	// Set the union type and value based on the best candidate
	u.Type = best.Type.(MappingAttributeType)
	switch best.Type {
	case MappingAttributeTypeSetValueMapper:
		u.SetValueMapper = best.Value.(*SetValueMapper)
		return nil
	case MappingAttributeTypeCopyValueMapper:
		u.CopyValueMapper = best.Value.(*CopyValueMapper)
		return nil
	case MappingAttributeTypeAppendValueMapper:
		u.AppendValueMapper = best.Value.(*AppendValueMapper)
		return nil
	}

	return fmt.Errorf("could not unmarshal `%s` into any supported union types for MappingAttribute", string(data))
}

func (u MappingAttribute) MarshalJSON() ([]byte, error) {
	if u.SetValueMapper != nil {
		return utils.MarshalJSON(u.SetValueMapper, "", true)
	}

	if u.CopyValueMapper != nil {
		return utils.MarshalJSON(u.CopyValueMapper, "", true)
	}

	if u.AppendValueMapper != nil {
		return utils.MarshalJSON(u.AppendValueMapper, "", true)
	}

	return nil, errors.New("could not marshal union type MappingAttribute: all fields are null")
}
